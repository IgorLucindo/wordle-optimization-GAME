make all code have correct adaptation of cpu and gpu (e.g. subtree metric, hardmode)